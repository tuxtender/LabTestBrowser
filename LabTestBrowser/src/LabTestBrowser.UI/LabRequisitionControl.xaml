<UserControl x:Class="LabTestBrowser.UI.LabRequisitionControl"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:local="clr-namespace:LabTestBrowser.UI"
			 xmlns:ui="http://schemas.modernwpf.com/2019"
			 xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
			 mc:Ignorable="d"
			 d:DataContext="{d:DesignInstance {x:Type local:LabRequisitionViewModel}}">

	<GroupBox Header="Образец">

		<StackPanel>
			<DatePicker HorizontalAlignment="Left"
						Width="200"
						SelectedDate="{Binding LabOrderDate, Converter={StaticResource DateConverter}}"
						ui:ControlHelper.Header="Дата обследования"
						ui:ControlHelper.PlaceholderText="Выбрать дату">
				<b:Interaction.Triggers>
					<b:EventTrigger EventName="CalendarClosed">
						<!-- TODO: Refactor -->
						<b:InvokeCommandAction Command="{Binding RelativeSource={RelativeSource FindAncestor, 
    AncestorType={x:Type Window}}, Path=DataContext.UpdateCommand}"
											   CommandParameter="{Binding LabOrderDate}"  />
					</b:EventTrigger>
				</b:Interaction.Triggers>
			</DatePicker>

			<ui:NumberBox Header="Номер образца"
						  Width="200"
						  Value="{Binding LabOrderNumber, Mode=TwoWay}"
						  Minimum="1"
						  Maximum="1000">
				<b:Interaction.Triggers>
					<b:EventTrigger EventName="ValueChanged">
						<!-- TODO: Refactor with PreviewTextInput -->
						<b:InvokeCommandAction Command="{Binding RelativeSource={RelativeSource FindAncestor,
    AncestorType={x:Type Window}}, Path=DataContext.UpdateReportCommand}" />
					</b:EventTrigger>
				</b:Interaction.Triggers>
			</ui:NumberBox>

			<ComboBox Name="FacilityComboBox"
					  HorizontalAlignment="Left"
					  ItemsSource="{Binding CollectionCenters}"
					  Text="{Binding Facility}"
					  TextSearch.TextPath="Facility"
					  ui:ControlHelper.Header="Организация"
					  Width="200">
				<ComboBox.ItemTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Facility}" />
					</DataTemplate>
				</ComboBox.ItemTemplate>
			</ComboBox>

			<ComboBox IsEditable="True"
					  HorizontalAlignment="Left"
					  ItemsSource="{Binding ElementName=FacilityComboBox, Path=SelectedItem.TradeNames}"
					  Text="{Binding  TradeName}"
					  ui:ControlHelper.Header="Торговое название"
					  Width="200" />

			<ComboBox Name="AnimalSpeciesComboBox"
					  HorizontalAlignment="Left"
					  ItemsSource="{Binding AnimalSpecies}"
					  Text="{Binding Animal}"
					  TextSearch.TextPath="Name"
					  ui:ControlHelper.Header="Животное"
					  Width="200">
				<ComboBox.ItemTemplate>
					<DataTemplate>
						<TextBlock Text="{Binding Name}" />
					</DataTemplate>
				</ComboBox.ItemTemplate>
			</ComboBox>
			
			<ui:AutoSuggestBox Text="{Binding PetOwner, Mode=TwoWay}"
							   Width="200"
							   ui:ControlHelper.Header="Владелец" />


			<ui:AutoSuggestBox Text="{Binding Nickname, Mode=TwoWay}"
							   Width="200"
							   ui:ControlHelper.Header="Имя питомца" />


			<ui:AutoSuggestBox Name="BreedSuggestionBox"
							   Text="{Binding Breed, Mode=TwoWay}"
							   ItemsSource="{Binding ElementName=AnimalSpeciesComboBox, Path=SelectedItem.SuggestedBreeds}"
							   Width="200"
							   ui:ControlHelper.Header="Порода">
				<b:Interaction.Triggers>
					<b:EventTrigger EventName="TextChanged">
						<b:InvokeCommandAction Command="{Binding ElementName=AnimalSpeciesComboBox, Path= SelectedItem.SuggestBreedCommand}"
											   CommandParameter="{Binding ElementName=BreedSuggestionBox, Path=Text}" />
					</b:EventTrigger>
				</b:Interaction.Triggers>
			</ui:AutoSuggestBox>

			<ComboBox IsEditable="True"
					  HorizontalAlignment="Left"
					  ItemsSource="{Binding ElementName=AnimalSpeciesComboBox, Path=SelectedItem.Categories}"
					  Text="{Binding Category}"
					  ui:ControlHelper.Header="Категория"
					  Width="200" />

			<Grid Width="200">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="1*" />
					<ColumnDefinition Width="1*" />
					<ColumnDefinition Width="1*" />
				</Grid.ColumnDefinitions>

				<ui:NumberBox Grid.Column="0"
							  Header="Возраст"
							  Value="{Binding AgeInYears, Converter={StaticResource AgeConverter}}"
							  Minimum="0"
							  Margin="0,0,1,0"
							  PlaceholderText="лет"
							  AcceptsExpression="False" />

				<ui:NumberBox Grid.Column="1"
							  Header=" "
							  Value="{Binding AgeInMonths,  Converter={StaticResource AgeConverter}}"
							  Minimum="0"
							  Margin="1,0,1,0"
							  PlaceholderText="мес"
							  AcceptsExpression="False" />

				<ui:NumberBox Grid.Column="2"
							  Header=" "
							  Value="{Binding AgeInDays, Converter={StaticResource AgeConverter}}"
							  Minimum="0"
							  Margin="1,0,0,0"
							  PlaceholderText="дней"
							  AcceptsExpression="False" />

			</Grid>
		</StackPanel>
	</GroupBox>
</UserControl>